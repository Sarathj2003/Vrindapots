




{% extends 'base.html' %}
{% load static %}

{% block content %}

<main class="main">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    

    
    <div class="container">
        <hr class="mt-2 mb-1">
    </div><!-- End .container -->

    <!-- product section -->

    <!-- new container for listing Exclusive Offer products -->
    <div class="bg-lighter ">
        <div class="container mt-5">
            <!-- Payment Section -->
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="card shadow-lg">
                        <div class="card-header bg-primary text-white text-center">
                            <h3>Complete Your Payment</h3>
                        </div>
                        <div class="card-body">
                            <p class="text-center">
                                <strong>Order Amount:</strong> â‚¹100 <br>
                                <strong>Order Description:</strong> Purchase from Vrindapots
                            </p>
                            <div class="text-center mt-4">
                                <button id="rzp-button1" class="btn btn-primary btn-lg">
                                    Pay Now
                                </button>
                            </div>
                        </div>
                        <div class="card-footer text-center">
                            <small class="text-muted">Your payment is secure with Razorpay.</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    
        <script>
            var options = {
                "key": "{{ razorpay_key }}",  // Razorpay API Key
                "amount": "{{ amount }}",  // Amount in paise
                "currency": "{{ currency }}",
                "name": "Vrindapots",
                "description": "Order Payment",
                "order_id": "{{ razorpay_order_id }}",  // Razorpay Order ID
                "handler": function (response) {
                    // Send payment details to the server for verification
                    fetch("{% url 'verify_payment' %}", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "X-CSRFToken": "{{ csrf_token }}"
                        },
                        body: JSON.stringify(response)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Redirect to the order success page
                            window.location.href = "{% url 'order_success' order.id %}";
                        } else {
                            // Show an alert for failed payment verification
                            alert("Payment verification failed. Please contact support.");
                        }
                    })
                    .catch(error => {
                        console.error("Error during payment verification:", error);
                        alert("An error occurred. Please try again later.");
                    });
                },
                "theme": {
                    "color": "#3399cc"
                }
            };
        
            var rzp1 = new Razorpay(options);
            document.getElementById('rzp-button1').onclick = function(e) {
                rzp1.open();
                e.preventDefault();
            }
        </script>
    
        
    </div>
    <!-- end container for listing all products -->

    <!-- product section end-->



    <div class="container">
        <hr class="mt-3 mb-4">
    </div><!-- End .container -->



    <div class="container">
        <hr class="mt-3 mt-xl-1 mb-0">
    </div><!-- End .container -->

    <div class="cta pt-4 pt-lg-6 pb-5 pb-lg-7 mb-0">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-sm-10 col-md-8 col-lg-6">
                    <div class="cta-heading text-center">
                        <h3 class="cta-title">Sign Up for updates from Molla</h3><!-- End .cta-title -->
                        <p class="cta-desc">and receive <span class="font-weight-normal">$20 coupon</span> for first shopping</p><!-- End .cta-desc -->
                    </div><!-- End .text-center -->
                
                    <form action="#">
                        <div class="input-group">
                            <input type="email" class="form-control" placeholder="Enter your Email Address" aria-label="Email Adress" required>
                            <div class="input-group-append">
                                <button class="btn btn-primary" type="submit" title="Sing up"><i class="icon-long-arrow-right"></i></button>
                            </div><!-- .End .input-group-append -->
                        </div><!-- .End .input-group -->
                    </form>
                </div><!-- End .col-sm-10 col-md-8 col-lg-6 -->
            </div><!-- End .row -->
        </div><!-- End .container -->
    </div><!-- End .cta -->



    
</main><!-- End .main -->

{% endblock %}