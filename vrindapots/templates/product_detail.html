{% extends 'base.html' %}
{% load static %}

{% block content %}

<div class="container">
    <div class="product-details-top">
        <div class="row">
            <div class="col-md-6">
                <div class="product-gallery product-gallery-vertical">
                    <div class="row">
                        <style>
                            #imageZoom {
                                position: relative;
                            }
                            #imageZoom img {
                                width: 100%;
                                height: 100%;
                                object-fit: cover;
                            }
                            #imageZoom::after {
                                display: var(--display);
                                content: '';
                                width: 100%;
                                height: 100%;
                                background-color: black;
                                background-image: var(--url);
                                background-size: 200%; /* Adjust the zoom level here */
                                background-position: var(--zoom-x) var(--zoom-y);
                                position: absolute;
                                left: 0;
                                top: 0;
                                pointer-events: none;
                            }
                        </style>
                        
                        <div class="product-main-image" id="imageZoom" style="
                            --url: url('{{ product.image1.url }}');
                            --zoom-x: 0%; --zoom-y: 0%;
                            --display: none;
                        ">
                            <img id="mainImage" src="{{ product.image1.url }}" alt="">
                        </div>
                        
                        <script>
                            const imageZoom = document.getElementById('imageZoom');
                            const mainImage = document.getElementById('mainImage');
                    
                            // Function to update the image and zoom
                            function updateImage(imageSrc, zoomImageSrc) {
                                mainImage.src = imageSrc;
                                imageZoom.style.setProperty('--url', `url('${zoomImageSrc}')`);
                            }
                    
                            // Zoom functionality
                            imageZoom.addEventListener('mousemove', (event) => {
                                const rect = imageZoom.getBoundingClientRect();
                                const offsetX = event.clientX - rect.left;
                                const offsetY = event.clientY - rect.top;
                                
                                const pointerX = Math.min(Math.max((offsetX / rect.width) * 100, 0), 100);
                                const pointerY = Math.min(Math.max((offsetY / rect.height) * 100, 0), 100);
                                
                                imageZoom.style.setProperty('--zoom-x', pointerX + '%');
                                imageZoom.style.setProperty('--zoom-y', pointerY + '%');
                                imageZoom.style.setProperty('--display', 'block');
                            });
                    
                            imageZoom.addEventListener('mouseout', () => {
                                imageZoom.style.setProperty('--display', 'none');
                            });
                        </script>
                        
                        <div id="product-zoom-gallery" class="product-image-gallery" style="height: 200px;">
                            <a class="product-gallery-item " href="#" onclick="updateImage('{{ product.image1.url }}', '{{ product.image1.url }}'); return false;">
                                <img src="{{ product.image1.url }}" alt="product side">
                            </a>
                    
                            <a class="product-gallery-item" href="#" onclick="updateImage('{{ product.image2.url }}', '{{ product.image2.url }}'); return false;">
                                <img src="{{ product.image2.url }}" alt="product cross">
                            </a>
                    
                            <a class="product-gallery-item" href="#" onclick="updateImage('{{ product.image3.url }}', '{{ product.image3.url }}'); return false;">
                                <img src="{{ product.image3.url }}" alt="product cross">
                            </a>
                        </div><!-- End .product-image-gallery -->
                    </div><!-- End .row -->
                    
                </div><!-- End .product-gallery -->
            </div><!-- End .col-md-6 -->

            <div class="col-md-6">
                <div class="product-details " style="margin-top: 50px;">
                    <div class="product-title" style="font-size: 30px;">{{ product.name }}</div>
                    <div class="product-title" style="font-size: 20px; color: rgba(0, 0, 0, 0.562);">({{ product.category }})</div>

                    <div class="ratings-container">
                        <div class="ratings">
                            <div class="ratings-val" style="width: {{ rating_percentage }}%;"></div><!-- End .ratings-val -->
                        </div><!-- End .ratings -->
                        <a class="ratings-text" href="#product-review-link" id="review-link">( {{ total_reviews }} Reviews )</a>
                    </div><!-- End .rating-container -->
                    
                    <div class="product-price" style="font-size: 30px;">
                        ₹{{ product.new_price }}
                    </div><!-- End .product-price -->

                    <div class="old-price" style="font-size: 20px;margin-top: -20px;">
                        ₹{{ product.old_price }}
                    </div><!-- End .product-price -->
                    

                    <div class="product-content" style="margin-top: 10px;">
                        <p>{{ product.description }} </p>
                    </div><!-- End .product-content -->

                    

                    <div class="details-filter-row details-row-size" >
                        <label for="qty">Qty:</label>
                        <div class="product-details-quantity">
                            <input type="number" id="qty" class="form-control" value="1" min="1" max="10" step="1" data-decimals="0" required>
                        </div><!-- End .product-details-quantity -->
                    </div><!-- End .details-filter-row -->

                    <div class="product-details-action">
                        <a href="#" class="btn-product btn-cart"><span>add to cart</span></a>

                        <div class="details-action-wrapper">
                            <a href="#" class="btn-product btn-wishlist" title="Wishlist"><span>Add to Wishlist</span></a>
                            
                        </div><!-- End .details-action-wrapper -->
                    </div><!-- End .product-details-action -->

                    
                </div><!-- End .product-details -->
            </div><!-- End .col-md-6 -->
        </div><!-- End .row -->

        <!-- review section -->

        <div class="row">
            <div class="col-md-4">
                <div class="card" style="width: 40rem;">
                    <div class="card-body">
                        <h5 class="card-title" style="margin-bottom: 10px;">Customer Reviews</h5>
                        <div class="ratings-container">
                            <div class="ratings" >
                                <div class="ratings-val" style="width: {{ rating_percentage }}%;" ></div><!-- End .ratings-val -->
                                <h6 style="margin-top: 10px;"> {{ average_rating|default:"No ratings yet" }} </h6>
                            </div><!-- End .ratings -->
                        </div><!-- End .ratings-container -->
                        <span class="ratings-text">( {{ total_reviews }} Reviews )</span>
                    </div>
                </div>
            </div>
            <div class="col-md-1">
            </div>
            <div class="col-md-7">
                <div class="card" style="width: 60rem;">
                    {% for review in reviews %}
                    <div class="card-body">
                        <div class="card-title" style="margin-bottom: 10px; color: black;">{{ review.user.profile.full_name }}</div>
                        <div class="ratings-container">
                            <div class="ratings">
                                <div class="ratings-val" style="width: 50%;"></div><!-- End .ratings-val -->
                            </div><!-- End .ratings -->
                        </div><!-- End .ratings-container -->
                        <div class="card-text" style="color: rgba(0, 0, 0, 0.473);">Reviewed on {{ review.created_at|date:"F j, Y" }}</div>
                        <p class="card-text">{{ review.comment }}</p>
                    </div>
                    {% empty %}
                    <li>No reviews yet. Be the first to review this product!</li>
                    {% endfor %}
                </div>
                
            </div>
        </div>

        <!-- review section end -->

    </div><!-- End .product-details-top -->


    
</div>

{% endblock %}